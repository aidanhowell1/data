---
title: "E-commerce Data Analysis (R)"
output: html_document
---

```{r setup, include=FALSE}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(RColorBrewer)

df <- read_csv("../data/ecommerce_sales_data.csv")
```

## Data Cleaning

```{r}
summary(df)
sum(is.na(df))
```

## Sales Trend Over Time

```{r}
df$OrderDate <- as.Date(df$OrderDate)
daily_sales <- df %>%
  group_by(OrderDate) %>%
  summarise(TotalSales = sum(OrderAmount), .groups="drop")
ggplot(daily_sales, aes(x = OrderDate, y = TotalSales)) +
  geom_line() +
  labs(title = "Daily Sales Trend",
       x = "Date",
       y = "Total Sales ($)")
ggsave("../visualizations/sales_trends_r.png", width = 12, height = 5)
```

## Average Order Amount by Region

```{r}
avg_region <- df %>%
  group_by(Region) %>%
  summarise(AvgOrderAmount = mean(OrderAmount), .groups="drop")
ggplot(avg_region, aes(x = Region, y = AvgOrderAmount)) +
  geom_col() +
  labs(title = "Average Order Amount by Region",
       x = "Region",
       y = "Average Order Amount")
ggsave("../visualizations/region_avg_order_r.png", width = 8, height = 5)
```

## Product Category vs Payment Method (Heatmap)

```{r}
pivot <- df %>%
  group_by(ProductCategory, PaymentMethod) %>%
  summarise(TotalSales = sum(OrderAmount), .groups="drop") %>%
  tidyr::pivot_wider(names_from = PaymentMethod, values_from = TotalSales)
pivot_matrix <- as.matrix(select(pivot, -ProductCategory))
rownames(pivot_matrix) <- pivot$ProductCategory
png("../visualizations/category_heatmap_r.png", width = 800, height = 600)
heatmap(
  pivot_matrix,
  Rowv = NA, Colv = NA,
  col = brewer.pal(9, "Blues"),
  scale = "none",
  main = "Sales by Product Category and Payment Method"
)
dev.off()
```

## Customer Age vs. Order Amount

```{r}
ggplot(df, aes(x = Age, y = OrderAmount, color = Gender)) +
  geom_point(alpha = 0.7) +
  labs(title = "Customer Age vs. Order Amount",
       x = "Age",
       y = "Order Amount ($)")
ggsave("../visualizations/age_vs_order_r.png", width = 8, height = 5)
```
